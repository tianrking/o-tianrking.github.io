---
title: "17智能车完全模型组比赛记录"
date: 2022-03-09T15:11:10+08:00
draft: true
---

## 边缘检测部分

### 环境配置

```bash
git clone https://gitee.com/paddlepaddle/PaddleSeg.git 
ls /home/aistudio/work
pip install paddleseg -i https://mirror.baidu.com/pypi/simple
```

### 比赛数据准备

```bash
unzip -d /home/aistudio/data/ /home/aistudio/data/data125507/car_data_2022.zip
```

### 语义分割模型训练及模型转换

#### 增添配置文件

```bash
cd /home/aistudio/work/PaddleSeg/
ls
```

```bash
# # 官方数据已经为我们提供好了train_list.txt和val_list.txt的文件，为了将比赛的数据集与现有的区分开，这里新建一个数据集配置文件
# 新的配置文件命名为car2022.yml，存放路径为:PaddleSeg/configs/_base_/car2022.yml
ls /home/aistudio/work/PaddleSeg/configs/_base_/

# 语义分割模型使用bisenet，在PaddleSeg/configs/bisenet/路径下，已经写好了针对本次比赛的bisenet_car_480x480.yml
ls /home/aistudio/work/PaddleSeg/configs/bisenet/
```

#### 训练并保存模型

```bash
python train.py --config configs/bisenet/bisenet_car_480x480.yml --do_eval --save_interval 400
```

#### 转换评估

```bash
python val.py --config configs/bisenet/bisenet_car_480x480.yml --model_path output/best_model/model.pdparams
```

#### 模型结果预测

```bash
python predict.py --config configs/bisenet/bisenet_car_480x480.yml --model_path output/best_model/model.pdparams --image_path ./../../data/car_data_2022/JPEGImages --save_dir output/result
```

#### 转换并保存静态图模型

```bash
python export.py --config configs/bisenet/bisenet_car_480x480.yml --model_path output/best_model/model.pdparams
```

```bash
# 转换好的模型将会存放在output/中
!ls output/
```

#### resize修改

由于export时，deploy.yaml文件中并未将训练时resize的信息写入，这里要自己把resize的信息写进去，否则预测时使用的分辨率与训练时不同

```--原始的deploy.yaml文件--

Deploy:

model: model.pdmodel

params: model.pdiparams

transforms:

type: Normalize
```

```--修改后的deploy.yaml文件--

Deploy:

model: model.pdmodel

params: model.pdiparams

transforms:

type: Resizetarget_size: [480, 480]interp: 'LINEAR'
type: Normalize
```

### 模型结果文件提交

```bash
# 创建model文件夹（已经创建好的话，就不用再创建了）
!mkdir model

# 将训练脚本拷贝到work目录下，与model同级
!cp PaddleSeg/train.py .
```

```bash
# 将分割模型拷贝到model文件夹中
!cp -r PaddleSeg/output/bisenet/ model/
!ls model/
```


将submit/model里的模型更换为你自己训练的模型，同时需要注意修改参数配置文件的内容；
尽可能优化predict.py里的代码，使得代码运行速度更快，效率更高；
文件格式上，submit文件夹下的data.txt是测试用的输入，result.json是测试的输出结果，当你正式提交时，应该把这两个文件删除；
代码里还存在着不够好的地方需要优化，掩码图转分割连通域的代码比较复杂，有很大的提升空间；
可在数据读取上尝试进行优化，opencv读取图像是默认是float32，如果使用uint8，速度会快不少；
可尝试对模型进行裁剪，或使用模型蒸馏，从而进一步加快运行速度。