"use strict";(self.webpackChunkEl_Jardin_Secreto_de_w0x7ce=self.webpackChunkEl_Jardin_Secreto_de_w0x7ce||[]).push([[1718],{5120:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>t,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>d,toc:()=>o});var c=i(4848),l=i(8453);const s={slug:"desarrollo-cdc-stm32cubemx",title:"Desarrollo de comunicaci\xf3n CDC con STM32CubeMX",authors:[{name:"w0x7ce",title:"Ingeniero de Sistemas Embebidos",url:"https://github.com/tianrking",image_url:"https://github.com/tianrking.png"}],tags:["stm32","usb","cdc"]},r="Desarrollo de comunicaci\xf3n CDC con STM32CubeMX",d={id:"micro-controladores/STM32/stm32_cdc_develop",title:"Desarrollo de comunicaci\xf3n CDC con STM32CubeMX",description:"Configuraci\xf3n de STM32CubeMX",source:"@site/docs/micro-controladores/STM32/stm32_cdc_develop.md",sourceDirName:"micro-controladores/STM32",slug:"/micro-controladores/STM32/desarrollo-cdc-stm32cubemx",permalink:"/en/micro-controladores/STM32/desarrollo-cdc-stm32cubemx",draft:!1,unlisted:!1,editUrl:"https://github.com/tianrking/tianrking.github.io/tree/V3.4/docs/micro-controladores/STM32/stm32_cdc_develop.md",tags:[{inline:!0,label:"stm32",permalink:"/en/tags/stm-32"},{inline:!0,label:"usb",permalink:"/en/tags/usb"},{inline:!0,label:"cdc",permalink:"/en/tags/cdc"}],version:"current",lastUpdatedAt:1720597722e3,frontMatter:{slug:"desarrollo-cdc-stm32cubemx",title:"Desarrollo de comunicaci\xf3n CDC con STM32CubeMX",authors:[{name:"w0x7ce",title:"Ingeniero de Sistemas Embebidos",url:"https://github.com/tianrking",image_url:"https://github.com/tianrking.png"}],tags:["stm32","usb","cdc"]},sidebar:"tutorialSidebar",previous:{title:"Winnermicro XT-E804 HLK-W801 Kit \u4f7f\u7528\u6307\u5357 | Winnermicro XT-E804 HLK-W801 Kit User Guide",permalink:"/en/micro-controladores/CN/winnermicro-XT-E804-HLK-W801-Kit"},next:{title:"Exploring WiFi Interfaces in ESP-IDF 5.3",permalink:"/en/micro-controladores/ESP32/esp32-idf-5.3-wifi-interfaces"}},t={},o=[{value:"Configuraci\xf3n de STM32CubeMX",id:"configuraci\xf3n-de-stm32cubemx",level:2},{value:"Implementaci\xf3n del c\xf3digo",id:"implementaci\xf3n-del-c\xf3digo",level:2},{value:"En la funci\xf3n <code>CDC_Receive_FS()</code>:",id:"en-la-funci\xf3n-cdc_receive_fs",level:3},{value:"En la funci\xf3n <code>CDC_Transmit_FS()</code>:",id:"en-la-funci\xf3n-cdc_transmit_fs",level:3},{value:"Habilitaci\xf3n de interrupciones",id:"habilitaci\xf3n-de-interrupciones",level:2},{value:"Procesamiento de datos",id:"procesamiento-de-datos",level:2},{value:"STM32CubeMX Configuration",id:"stm32cubemx-configuration",level:2},{value:"Code Implementation",id:"code-implementation",level:2},{value:"In the <code>CDC_Receive_FS()</code> function:",id:"in-the-cdc_receive_fs-function",level:3},{value:"In the <code>CDC_Transmit_FS()</code> function:",id:"in-the-cdc_transmit_fs-function",level:3},{value:"Interrupt Enablement",id:"interrupt-enablement",level:2},{value:"Data Processing",id:"data-processing",level:2},{value:"STM32CubeMX \u8a2d\u5b9a",id:"stm32cubemx-\u8a2d\u5b9a",level:2},{value:"\u7a0b\u5f0f\u78bc\u5be6\u4f5c",id:"\u7a0b\u5f0f\u78bc\u5be6\u4f5c",level:2},{value:"\u5728 <code>CDC_Receive_FS()</code> \u51fd\u6578\u4e2d:",id:"\u5728-cdc_receive_fs-\u51fd\u6578\u4e2d",level:3},{value:"\u5728 <code>CDC_Transmit_FS()</code> \u51fd\u6578\u4e2d:",id:"\u5728-cdc_transmit_fs-\u51fd\u6578\u4e2d",level:3},{value:"\u4e2d\u65b7\u555f\u7528",id:"\u4e2d\u65b7\u555f\u7528",level:2},{value:"\u8cc7\u6599\u8655\u7406",id:"\u8cc7\u6599\u8655\u7406",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",...(0,l.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.h1,{id:"desarrollo-de-comunicaci\xf3n-cdc-con-stm32cubemx",children:"Desarrollo de comunicaci\xf3n CDC con STM32CubeMX"}),"\n",(0,c.jsx)(n.h2,{id:"configuraci\xf3n-de-stm32cubemx",children:"Configuraci\xf3n de STM32CubeMX"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:"Habilitar el modo USB Device FS (Full Speed) en la pesta\xf1a de Pinout & Configuration."}),"\n",(0,c.jsx)(n.li,{children:"Seleccionar el modo CDC (Communication Device Class) en la pesta\xf1a de USB Device."}),"\n",(0,c.jsx)(n.li,{children:"Generar el c\xf3digo del proyecto."}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"implementaci\xf3n-del-c\xf3digo",children:"Implementaci\xf3n del c\xf3digo"}),"\n",(0,c.jsxs)(n.h3,{id:"en-la-funci\xf3n-cdc_receive_fs",children:["En la funci\xf3n ",(0,c.jsx)(n.code,{children:"CDC_Receive_FS()"}),":"]}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["Establecer el b\xfafer de recepci\xf3n USB utilizando ",(0,c.jsx)(n.code,{children:"USBD_CDC_SetRxBuffer()"}),"."]}),"\n",(0,c.jsxs)(n.li,{children:["Llamar a ",(0,c.jsx)(n.code,{children:"USBD_CDC_ReceivePacket()"})," para indicar que el dispositivo est\xe1 listo para recibir m\xe1s datos."]}),"\n",(0,c.jsxs)(n.li,{children:["Si se desea enviar los datos recibidos de vuelta al host, llamar a ",(0,c.jsx)(n.code,{children:"CDC_Transmit_FS()"}),"."]}),"\n",(0,c.jsxs)(n.li,{children:["Retornar ",(0,c.jsx)(n.code,{children:"USBD_OK"})," para indicar que los datos han sido procesados."]}),"\n"]}),"\n",(0,c.jsxs)(n.h3,{id:"en-la-funci\xf3n-cdc_transmit_fs",children:["En la funci\xf3n ",(0,c.jsx)(n.code,{children:"CDC_Transmit_FS()"}),":"]}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["Verificar el estado del b\xfafer de transmisi\xf3n USB (",(0,c.jsx)(n.code,{children:"hcdc->TxState"}),")."]}),"\n",(0,c.jsxs)(n.li,{children:["Establecer el b\xfafer de transmisi\xf3n USB utilizando ",(0,c.jsx)(n.code,{children:"USBD_CDC_SetTxBuffer()"}),"."]}),"\n",(0,c.jsxs)(n.li,{children:["Llamar a ",(0,c.jsx)(n.code,{children:"USBD_CDC_TransmitPacket()"})," para enviar los datos."]}),"\n",(0,c.jsx)(n.li,{children:"Retornar el resultado de la transmisi\xf3n."}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"habilitaci\xf3n-de-interrupciones",children:"Habilitaci\xf3n de interrupciones"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:"Habilitar las interrupciones USB en el proyecto generado por STM32CubeMX."}),"\n",(0,c.jsxs)(n.li,{children:["Implementar las funciones de callback de recepci\xf3n y transmisi\xf3n USB, como ",(0,c.jsx)(n.code,{children:"USBD_CDC_DataReceived_FS()"})," y ",(0,c.jsx)(n.code,{children:"USBD_CDC_TransmitCplt_FS()"}),"."]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"procesamiento-de-datos",children:"Procesamiento de datos"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:"En las funciones de callback, procesar los datos recibidos y preparar los datos a enviar."}),"\n",(0,c.jsxs)(n.li,{children:["Utilizar las funciones ",(0,c.jsx)(n.code,{children:"CDC_Receive_FS()"})," y ",(0,c.jsx)(n.code,{children:"CDC_Transmit_FS()"})," para gestionar la recepci\xf3n y transmisi\xf3n de datos."]}),"\n"]}),"\n",(0,c.jsx)(n.h1,{id:"cdc-development-with-stm32cubemx",children:"CDC Development with STM32CubeMX"}),"\n",(0,c.jsx)(n.h2,{id:"stm32cubemx-configuration",children:"STM32CubeMX Configuration"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:"Enable USB Device FS (Full Speed) mode in the Pinout & Configuration tab."}),"\n",(0,c.jsx)(n.li,{children:"Select CDC (Communication Device Class) mode in the USB Device tab."}),"\n",(0,c.jsx)(n.li,{children:"Generate the project code."}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"code-implementation",children:"Code Implementation"}),"\n",(0,c.jsxs)(n.h3,{id:"in-the-cdc_receive_fs-function",children:["In the ",(0,c.jsx)(n.code,{children:"CDC_Receive_FS()"})," function:"]}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["Set the USB receive buffer using ",(0,c.jsx)(n.code,{children:"USBD_CDC_SetRxBuffer()"}),"."]}),"\n",(0,c.jsxs)(n.li,{children:["Call ",(0,c.jsx)(n.code,{children:"USBD_CDC_ReceivePacket()"})," to indicate the device is ready to receive more data."]}),"\n",(0,c.jsxs)(n.li,{children:["If you want to send the received data back to the host, call ",(0,c.jsx)(n.code,{children:"CDC_Transmit_FS()"}),"."]}),"\n",(0,c.jsxs)(n.li,{children:["Return ",(0,c.jsx)(n.code,{children:"USBD_OK"})," to indicate the data has been processed."]}),"\n"]}),"\n",(0,c.jsxs)(n.h3,{id:"in-the-cdc_transmit_fs-function",children:["In the ",(0,c.jsx)(n.code,{children:"CDC_Transmit_FS()"})," function:"]}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["Verify the state of the USB transmit buffer (",(0,c.jsx)(n.code,{children:"hcdc->TxState"}),")."]}),"\n",(0,c.jsxs)(n.li,{children:["Set the USB transmit buffer using ",(0,c.jsx)(n.code,{children:"USBD_CDC_SetTxBuffer()"}),"."]}),"\n",(0,c.jsxs)(n.li,{children:["Call ",(0,c.jsx)(n.code,{children:"USBD_CDC_TransmitPacket()"})," to send the data."]}),"\n",(0,c.jsx)(n.li,{children:"Return the result of the transmission."}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"interrupt-enablement",children:"Interrupt Enablement"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:"Enable the USB interrupts in the project generated by STM32CubeMX."}),"\n",(0,c.jsxs)(n.li,{children:["Implement the USB receive and transmit callback functions, such as ",(0,c.jsx)(n.code,{children:"USBD_CDC_DataReceived_FS()"})," and ",(0,c.jsx)(n.code,{children:"USBD_CDC_TransmitCplt_FS()"}),"."]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"data-processing",children:"Data Processing"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:"In the callback functions, process the received data and prepare the data to be sent."}),"\n",(0,c.jsxs)(n.li,{children:["Use the ",(0,c.jsx)(n.code,{children:"CDC_Receive_FS()"})," and ",(0,c.jsx)(n.code,{children:"CDC_Transmit_FS()"})," functions to manage the data reception and transmission."]}),"\n"]}),"\n",(0,c.jsx)(n.h1,{id:"\u4f7f\u7528-stm32cubemx-\u958b\u767c-cdc-\u901a\u8a0a",children:"\u4f7f\u7528 STM32CubeMX \u958b\u767c CDC \u901a\u8a0a"}),"\n",(0,c.jsx)(n.h2,{id:"stm32cubemx-\u8a2d\u5b9a",children:"STM32CubeMX \u8a2d\u5b9a"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:"\u5728 Pinout & Configuration \u6a19\u7c64\u4e2d\u555f\u7528 USB Device FS (Full Speed) \u6a21\u5f0f\u3002"}),"\n",(0,c.jsx)(n.li,{children:"\u5728 USB Device \u6a19\u7c64\u4e2d\u9078\u64c7 CDC (Communication Device Class) \u6a21\u5f0f\u3002"}),"\n",(0,c.jsx)(n.li,{children:"\u7522\u751f\u5c08\u6848\u7a0b\u5f0f\u78bc\u3002"}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"\u7a0b\u5f0f\u78bc\u5be6\u4f5c",children:"\u7a0b\u5f0f\u78bc\u5be6\u4f5c"}),"\n",(0,c.jsxs)(n.h3,{id:"\u5728-cdc_receive_fs-\u51fd\u6578\u4e2d",children:["\u5728 ",(0,c.jsx)(n.code,{children:"CDC_Receive_FS()"})," \u51fd\u6578\u4e2d:"]}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["\u4f7f\u7528 ",(0,c.jsx)(n.code,{children:"USBD_CDC_SetRxBuffer()"})," \u8a2d\u5b9a\u63a5\u6536\u7de9\u885d\u5340\u3002"]}),"\n",(0,c.jsxs)(n.li,{children:["\u547c\u53eb ",(0,c.jsx)(n.code,{children:"USBD_CDC_ReceivePacket()"})," \u8868\u793a\u8a2d\u5099\u5df2\u6e96\u5099\u597d\u63a5\u6536\u66f4\u591a\u8cc7\u6599\u3002"]}),"\n",(0,c.jsxs)(n.li,{children:["\u5982\u679c\u9700\u8981\u5c07\u6536\u5230\u7684\u8cc7\u6599\u56de\u50b3\u81f3\u4e3b\u6a5f, \u547c\u53eb ",(0,c.jsx)(n.code,{children:"CDC_Transmit_FS()"}),"\u3002"]}),"\n",(0,c.jsxs)(n.li,{children:["\u8fd4\u56de ",(0,c.jsx)(n.code,{children:"USBD_OK"})," \u8868\u793a\u8cc7\u6599\u5df2\u8655\u7406\u5b8c\u6210\u3002"]}),"\n"]}),"\n",(0,c.jsxs)(n.h3,{id:"\u5728-cdc_transmit_fs-\u51fd\u6578\u4e2d",children:["\u5728 ",(0,c.jsx)(n.code,{children:"CDC_Transmit_FS()"})," \u51fd\u6578\u4e2d:"]}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["\u6aa2\u67e5\u50b3\u8f38\u7de9\u885d\u5340\u7684\u72c0\u614b (",(0,c.jsx)(n.code,{children:"hcdc->TxState"}),")\u3002"]}),"\n",(0,c.jsxs)(n.li,{children:["\u4f7f\u7528 ",(0,c.jsx)(n.code,{children:"USBD_CDC_SetTxBuffer()"})," \u8a2d\u5b9a\u50b3\u8f38\u7de9\u885d\u5340\u3002"]}),"\n",(0,c.jsxs)(n.li,{children:["\u547c\u53eb ",(0,c.jsx)(n.code,{children:"USBD_CDC_TransmitPacket()"})," \u50b3\u9001\u8cc7\u6599\u3002"]}),"\n",(0,c.jsx)(n.li,{children:"\u8fd4\u56de\u50b3\u8f38\u7d50\u679c\u3002"}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"\u4e2d\u65b7\u555f\u7528",children:"\u4e2d\u65b7\u555f\u7528"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:"\u5728 STM32CubeMX \u7522\u751f\u7684\u5c08\u6848\u4e2d\u555f\u7528 USB \u4e2d\u65b7\u3002"}),"\n",(0,c.jsxs)(n.li,{children:["\u5be6\u4f5c\u63a5\u6536\u548c\u50b3\u8f38\u7684\u56de\u547c\u51fd\u6578, \u5982 ",(0,c.jsx)(n.code,{children:"USBD_CDC_DataReceived_FS()"})," \u548c ",(0,c.jsx)(n.code,{children:"USBD_CDC_TransmitCplt_FS()"}),"\u3002"]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"\u8cc7\u6599\u8655\u7406",children:"\u8cc7\u6599\u8655\u7406"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:"\u5728\u56de\u547c\u51fd\u6578\u4e2d\u8655\u7406\u63a5\u6536\u5230\u7684\u8cc7\u6599, \u4e26\u6e96\u5099\u8981\u50b3\u9001\u7684\u8cc7\u6599\u3002"}),"\n",(0,c.jsxs)(n.li,{children:["\u4f7f\u7528 ",(0,c.jsx)(n.code,{children:"CDC_Receive_FS()"})," \u548c ",(0,c.jsx)(n.code,{children:"CDC_Transmit_FS()"})," \u51fd\u6578\u7ba1\u7406\u8cc7\u6599\u7684\u63a5\u6536\u548c\u50b3\u8f38\u3002"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(a,{...e})}):a(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>d});var c=i(6540);const l={},s=c.createContext(l);function r(e){const n=c.useContext(s);return c.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),c.createElement(s.Provider,{value:n},e.children)}}}]);