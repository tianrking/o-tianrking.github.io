<!doctype html>
<html lang="en-US" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-micro-controladores/ESP32/esp32-mcpwm-usage-and-examples" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">ESP32 MCPWM Usage Guide and Examples | ESP32 MCPWM 使用指南與範例 | 🌵 El Jardín Secreto 🌵 </title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://me.w0x7ce.eu/en/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://me.w0x7ce.eu/en/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://me.w0x7ce.eu/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples"><meta data-rh="true" property="og:locale" content="en_US"><meta data-rh="true" property="og:locale:alternate" content="es_ES"><meta data-rh="true" property="og:locale:alternate" content="zh_HK"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="ESP32 MCPWM Usage Guide and Examples | ESP32 MCPWM 使用指南與範例 | 🌵 El Jardín Secreto 🌵 "><meta data-rh="true" name="description" content="引言"><meta data-rh="true" property="og:description" content="引言"><link data-rh="true" rel="icon" href="/en/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://me.w0x7ce.eu/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples"><link data-rh="true" rel="alternate" href="https://me.w0x7ce.eu/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples" hreflang="es-ES"><link data-rh="true" rel="alternate" href="https://me.w0x7ce.eu/zh-hk/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples" hreflang="zh-HK"><link data-rh="true" rel="alternate" href="https://me.w0x7ce.eu/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://me.w0x7ce.eu/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/en/blog/rss.xml" title="🌵 El Jardín Secreto 🌵  RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/en/blog/atom.xml" title="🌵 El Jardín Secreto 🌵  Atom Feed"><link rel="stylesheet" href="/en/assets/css/styles.742bc33a.css">
<script src="/en/assets/js/runtime~main.3b64ddb7.js" defer="defer"></script>
<script src="/en/assets/js/main.cee2c41c.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/en/"><div class="navbar__logo"><img src="https://github.com/tianrking.png" alt="Logo de El Jardín Secreto" class="themedComponent__dKv themedComponent--light_rzkv"><img src="https://github.com/tianrking.png" alt="Logo de El Jardín Secreto" class="themedComponent__dKv themedComponent--dark_mMAk"></div><b class="navbar__title text--truncate">🌵 El Jardín Secreto 🌵</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/en/tutorial">Tutorial</a><a class="navbar__item navbar__link" href="/en/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/tianrking" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="es-ES">Español</a></li><li><a href="/zh-hk/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-HK">繁體中文</a></li><li><a href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en-US">English</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS darkNavbarColorModeToggle_X3D1" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/en/"><img src="https://github.com/tianrking.png" alt="Logo de El Jardín Secreto" class="themedComponent__dKv themedComponent--light_rzkv"><img src="https://github.com/tianrking.png" alt="Logo de El Jardín Secreto" class="themedComponent__dKv themedComponent--dark_mMAk"><b>🌵 El Jardín Secreto 🌵</b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/tutorial">Tutorial</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples">Micro-Controladores</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" tabindex="0" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples">CN</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples"> </a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en/micro-controladores/CN/bouffalo-network-interfaces">Exploring Network Interfaces on Bouffalo MCUs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en/micro-controladores/CN/embedded-development-board-uart-rts">UART RTS Troubleshooting Guide for Embedded Development Boards</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en/micro-controladores/CN/bouffalo-BL602-AI-WB2-32s">Bouffalo BL602 AI-WB2-32S 使用指南 | Bouffalo BL602 AI-WB2-32S User Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en/micro-controladores/CN/bouffalo-BL616-AI-M62-32s">Bouffalo BL616 AI-M62-32S 使用指南 | Bouffalo BL616 AI-M62-32S User Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en/micro-controladores/CN/bouffalo-BL618-Sipeed-M0P-Dock">Bouffalo BL618 Sipeed M0P Dock 使用指南 | Bouffalo BL618 Sipeed M0P Dock User Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en/micro-controladores/CN/winnermicro-XT-E804-HLK-W801-Kit">Winnermicro XT-E804 HLK-W801 Kit 使用指南 | Winnermicro XT-E804 HLK-W801 Kit User Guide</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" tabindex="0" href="/en/micro-controladores/STM32/desarrollo-cdc-stm32cubemx">STM32</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en/micro-controladores/STM32/desarrollo-cdc-stm32cubemx">Desarrollo de comunicación CDC con STM32CubeMX</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples">ESP32</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples"> </a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en/micro-controladores/ESP32/esp32-idf-5.3-wifi-interfaces">Exploring WiFi Interfaces in ESP-IDF 5.3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en/micro-controladores/ESP32/esp32-programming-examples-guide">ESP32 編程示例  指南 | Guía de Ejemplos de Programación para ESP32</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en/micro-controladores/ESP32/esp32-lista-de-ejemplos-de-programacion">Guía de Ejemplos de Programación para ESP32 | ESP32 编程示例指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples">ESP32 MCPWM Usage Guide and Examples | ESP32 MCPWM 使用指南與範例</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en/micro-controladores/ESP32/esp32-rp2040-nrf24l01-wireless-communication">ESP32 and RP2040 Wireless Communication with NRF24L01 | ESP32 與 RP2040 使用 NRF24L01 無線通信模組指南</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" tabindex="0" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples">RP2040</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples"> </a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en/micro-controladores/RP2040/rp2040-uart-interrupt-handling-and-usage">UART Interrupt Handling and Data Transmission in RP2040</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en/micro-controladores/RP2040/rp2040-pwm-usage-and-examples">Detailed Explanation of PWM Usage and Examples in RP2040</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en/micro-controladores/RP2040/rp2040-timer-and-alarm-usage">Timer and Alarm Usage in RP2040</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en/micro-controladores/RP2040/mastering-pio-programming-rp2040">Mastering PIO Programming on RP2040</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en/micro-controladores/RP2040/pio-uart-implementation-rp2040">Implementing UART (TX )with PIO on RP2040</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en/micro-controladores/RP2040/advanced-pio-led-control-resource-management-rp2040">Advanced PIO LED Control and Resource Management on RP2040</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/en/micro-controladores/RP2040/rp2040-rf24-demo">rp2040-rf24-demo</a></li></ul></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/en/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Micro-Controladores</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">ESP32</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">ESP32 MCPWM Usage Guide and Examples | ESP32 MCPWM 使用指南與範例</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>ESP32 MCPWM 使用指南與範例</h1>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="引言">引言<a class="hash-link" aria-label="Direct link to 引言" title="Direct link to 引言" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#引言">​</a></h2>
<p>ESP32 是一款功能強大的微控制器,其中 MCPWM (Motor Control Pulse Width Modulation) 模組是一個非常實用的功能,特別適合用於電機控制等應用。本文將詳細介紹 ESP32 的 MCPWM 功能,並提供具體的程式碼範例,包括基本的 PWM 輸出和步進電機控制。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="esp32-引腳功能推薦">ESP32 引腳功能推薦<a class="hash-link" aria-label="Direct link to ESP32 引腳功能推薦" title="Direct link to ESP32 引腳功能推薦" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#esp32-引腳功能推薦">​</a></h2>
<p>在開始使用 MCPWM 之前,我們先來了解一下 ESP32 的引腳功能。合理選擇引腳可以讓您的項目更加穩定高效。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="通用-gpio-輸入輸出">通用 GPIO (輸入/輸出)<a class="hash-link" aria-label="Direct link to 通用 GPIO (輸入/輸出)" title="Direct link to 通用 GPIO (輸入/輸出)" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#通用-gpio-輸入輸出">​</a></h3>
<p>以下引腳沒有特殊功能限制,可以安全地用於大多數項目：</p>
<ul>
<li>GPIO 13, 14, 16, 17, 18, 19, 21, 22, 23, 25, 26, 27, 32, 33</li>
</ul>
<p>這些引腳適合用於一般的數位輸入/輸出操作,如控制 LED、讀取按鈕狀態等。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="adc-類比數位轉換">ADC (類比數位轉換)<a class="hash-link" aria-label="Direct link to ADC (類比數位轉換)" title="Direct link to ADC (類比數位轉換)" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#adc-類比數位轉換">​</a></h3>
<p>ESP32 提供兩組 ADC,推薦使用以下引腳：</p>
<ul>
<li><strong>ADC1</strong>: GPIO 36, 39, 32, 33, 34, 35</li>
<li><strong>ADC2</strong> (僅在 Wi-Fi 未啟用時可用): GPIO 4, 0, 2, 15, 13, 12, 14, 27, 25, 26</li>
</ul>
<p>ADC 用於讀取類比信號,如感測器輸出、電池電壓等。注意 ADC2 在使用 Wi-Fi 時可能不可用。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="dac-數位 類比轉換">DAC (數位類比轉換)<a class="hash-link" aria-label="Direct link to DAC (數位類比轉換)" title="Direct link to DAC (數位類比轉換)" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#dac-數位類比轉換">​</a></h3>
<p>ESP32 有兩個 DAC 通道,僅限以下引腳：</p>
<ul>
<li>GPIO 25, 26</li>
</ul>
<p>DAC 可以輸出類比電壓,適用於音頻輸出或控制類比設備。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="pwm-脈衝寬度調變">PWM (脈衝寬度調變)<a class="hash-link" aria-label="Direct link to PWM (脈衝寬度調變)" title="Direct link to PWM (脈衝寬度調變)" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#pwm-脈衝寬度調變">​</a></h3>
<p>除了 GPIO 34-39 和 SPI flash 引腳 (6-11) 外,所有輸出引腳都可用於 PWM。推薦使用：</p>
<ul>
<li>GPIO 13, 14, 16, 17, 18, 19, 21, 22, 23, 25, 26, 27, 32, 33</li>
</ul>
<p>PWM 可用於 LED 亮度控制、馬達速度控制等應用。</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="mcpwm-高級-pwm">MCPWM (高級 PWM)<a class="hash-link" aria-label="Direct link to MCPWM (高級 PWM)" title="Direct link to MCPWM (高級 PWM)" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#mcpwm-高級-pwm">​</a></h4>
<p>ESP32 有兩個 MCPWM 單元（MCPWM0 和 MCPWM1）,每個單元有 3 個定時器和 6 個輸出。</p>
<ul>
<li><strong>MCPWM0</strong> 和 <strong>MCPWM1</strong> 可用引腳：GPIO 0, 2, 4, 5, 12, 13, 14, 15, 18, 19, 21, 22, 23, 25, 26, 27, 32, 33</li>
<li>推薦使用：GPIO 13, 14, 16, 17, 18, 19, 21, 22, 23, 25, 26, 27, 32, 33</li>
</ul>
<p>MCPWM 特別適合用於複雜的電機控制應用,如無刷直流電機、步進電機等。</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="互補輸出">互補輸出<a class="hash-link" aria-label="Direct link to 互補輸出" title="Direct link to 互補輸出" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#互補輸出">​</a></h4>
<p>每個 MCPWM 單元的 6 個輸出被分為 3 對,每對可以輸出互補信號。互補對可以分配到幾乎任意 GPIO 組合。對於互補輸出,您需要選擇同一 MCPWM 單元中的一對輸出。例如：</p>
<ul>
<li><strong>MCPWM0</strong>：<!-- -->
<ul>
<li>PWM0A - PWM0B</li>
<li>PWM1A - PWM1B</li>
<li>PWM2A - PWM2B</li>
</ul>
</li>
<li><strong>MCPWM1</strong> 同理</li>
</ul>
<p>互補輸出在控制 H 橋電路時特別有用,可以確保兩個開關不會同時導通。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="i2c">I2C<a class="hash-link" aria-label="Direct link to I2C" title="Direct link to I2C" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#i2c">​</a></h3>
<p>默認引腳如下：</p>
<ul>
<li>SDA：GPIO 21</li>
<li>SCL：GPIO 22</li>
</ul>
<p>可配置為其他引腳,但推薦使用默認值以保持一致性。I2C 用於與各種感測器和顯示器通信。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="spi">SPI<a class="hash-link" aria-label="Direct link to SPI" title="Direct link to SPI" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#spi">​</a></h3>
<p>ESP32 支持兩組 SPI 引腳：</p>
<ul>
<li><strong>VSPI (默認)</strong>：<!-- -->
<ul>
<li>MOSI：GPIO 23</li>
<li>MISO：GPIO 19</li>
<li>CLK：GPIO 18</li>
<li>CS：GPIO 5</li>
</ul>
</li>
<li><strong>HSPI</strong>：<!-- -->
<ul>
<li>MOSI：GPIO 13</li>
<li>MISO：GPIO 12</li>
<li>CLK：GPIO 14</li>
<li>CS：GPIO 15</li>
</ul>
</li>
</ul>
<p>SPI 用於高速數據傳輸,如讀寫 SD 卡、控制顯示屏等。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="uart">UART<a class="hash-link" aria-label="Direct link to UART" title="Direct link to UART" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#uart">​</a></h3>
<p>ESP32 有三個 UART 模組,引腳配置如下：</p>
<ul>
<li><strong>UART0 (默認)</strong>：<!-- -->
<ul>
<li>TX：GPIO 1</li>
<li>RX：GPIO 3</li>
</ul>
</li>
<li><strong>UART1</strong>：<!-- -->
<ul>
<li>TX：GPIO 10</li>
<li>RX：GPIO 9</li>
</ul>
</li>
<li><strong>UART2</strong>：<!-- -->
<ul>
<li>TX：GPIO 17</li>
<li>RX：GPIO 16</li>
</ul>
</li>
</ul>
<p>UART 用於串列通信,如與電腦通信或連接 GPS 模組等。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="電容式觸摸傳感器">電容式觸摸傳感器<a class="hash-link" aria-label="Direct link to 電容式觸摸傳感器" title="Direct link to 電容式觸摸傳感器" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#電容式觸摸傳感器">​</a></h3>
<p>推薦使用以下引腳,避免使用 Strapping 引腳：</p>
<ul>
<li>GPIO 13, 14, 27, 32, 33</li>
</ul>
<p>這些引腳可用於創建觸摸感應界面。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="rtc-gpio-深度睡眠模式可用">RTC GPIO (深度睡眠模式可用)<a class="hash-link" aria-label="Direct link to RTC GPIO (深度睡眠模式可用)" title="Direct link to RTC GPIO (深度睡眠模式可用)" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#rtc-gpio-深度睡眠模式可用">​</a></h3>
<p>以下引腳在深度睡眠模式下仍然可用：</p>
<ul>
<li>GPIO 0, 2, 4, 12-15, 25-27, 32-39</li>
</ul>
<p>這些引腳可用於在低功耗模式下喚醒設備。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="模擬霍爾傳感器">模擬霍爾傳感器<a class="hash-link" aria-label="Direct link to 模擬霍爾傳感器" title="Direct link to 模擬霍爾傳感器" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#模擬霍爾傳感器">​</a></h3>
<p>僅限以下引腳：</p>
<ul>
<li>GPIO 36, 39</li>
</ul>
<p>這些引腳專門用於連接霍爾效應感測器,用於檢測磁場。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="mcpwm-基礎知識">MCPWM 基礎知識<a class="hash-link" aria-label="Direct link to MCPWM 基礎知識" title="Direct link to MCPWM 基礎知識" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#mcpwm-基礎知識">​</a></h2>
<p>MCPWM (Motor Control Pulse Width Modulation) 是 ESP32 中一個強大的功能模組,專為電機控制設計。與普通的 PWM 相比,MCPWM 提供了更多的功能和靈活性：</p>
<ol>
<li>多通道輸出：每個 MCPWM 單元有 6 個獨立的輸出通道。</li>
<li>高精度：可以產生高頻率、高分辨率的 PWM 信號。</li>
<li>互補輸出：可以生成互補的 PWM 信號對,適用於 H 橋驅動。</li>
<li>死區控制：可以在互補信號之間插入死區時間,防止短路。</li>
<li>故障檢測：具有故障輸入功能,可以在檢測到故障時自動關閉輸出。</li>
<li>同步操作：多個 MCPWM 單元可以同步工作,適合多相電機控制。</li>
</ol>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="互補脈寬調製範例">互補脈寬調製範例<a class="hash-link" aria-label="Direct link to 互補脈寬調製範例" title="Direct link to 互補脈寬調製範例" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#互補脈寬調製範例">​</a></h2>
<p>以下是一個使用 MCPWM 產生互補 PWM 輸出的範例程式。這個範例展示了如何設置 MCPWM,並動態調整頻率和占空比。</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">mcpwm_normal_pwm_demo.c</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;freertos/FreeRTOS.h&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;freertos/task.h&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;esp_log.h&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;driver/mcpwm_prelude.h&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;inttypes.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static const char *TAG = &quot;example&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 定義 MCPWM 參數</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define MCPWM_TIMER_RESOLUTION_HZ 10000000 // 10MHz, 1 tick = 0.1us</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define MCPWM_FREQ_HZ_INITIAL     10000    // 初始頻率為 10KHz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define MCPWM_GPIO_A              18       // PWM 輸出 A 的 GPIO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define MCPWM_GPIO_B              21       // PWM 輸出 B 的 GPIO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define MCPWM_DUTY_CYCLE_INITIAL  30       // 初始占空比為 30%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// PWM 配置結構體</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">typedef struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mcpwm_timer_handle_t timer;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mcpwm_oper_handle_t oper;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mcpwm_cmpr_handle_t cmpa;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mcpwm_cmpr_handle_t cmpb;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mcpwm_gen_handle_t gena;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mcpwm_gen_handle_t genb;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} pwm_config_t;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 初始化 PWM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static pwm_config_t init_pwm(void) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pwm_config_t config;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_LOGI(TAG, &quot;初始化 MCPWM 模組&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 步驟 1: 創建 MCPWM 定時器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mcpwm_timer_config_t timer_config = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .group_id = 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .clk_src = MCPWM_TIMER_CLK_SRC_DEFAULT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .resolution_hz = MCPWM_TIMER_RESOLUTION_HZ,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .period_ticks = MCPWM_TIMER_RESOLUTION_HZ / MCPWM_FREQ_HZ_INITIAL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .count_mode = MCPWM_TIMER_COUNT_MODE_UP,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_new_timer(&amp;timer_config, &amp;config.timer));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 步驟 2: 創建 MCPWM 運算器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mcpwm_operator_config_t operator_config = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .group_id = 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_new_operator(&amp;operator_config, &amp;config.oper));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 步驟 3: 將定時器連接到運算器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_operator_connect_timer(config.oper, config.timer));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 步驟 4: 創建比較器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mcpwm_comparator_config_t comparator_config = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .flags.update_cmp_on_tez = true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_new_comparator(config.oper, &amp;comparator_config, &amp;config.cmpa));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_new_comparator(config.oper, &amp;comparator_config, &amp;config.cmpb));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 步驟 5: 創建 PWM 生成器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mcpwm_generator_config_t generator_config = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .gen_gpio_num = MCPWM_GPIO_A,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_new_generator(config.oper, &amp;generator_config, &amp;config.gena));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    generator_config.gen_gpio_num = MCPWM_GPIO_B;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_new_generator(config.oper, &amp;generator_config, &amp;config.genb));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 步驟 6: 設置生成器 A 的動作 (占空比)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_generator_set_actions_on_timer_event(config.gena,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MCPWM_GEN_TIMER_EVENT_ACTION(MCPWM_TIMER_DIRECTION_UP, MCPWM_TIMER_EVENT_EMPTY, MCPWM_GEN_ACTION_HIGH),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MCPWM_GEN_TIMER_EVENT_ACTION_END()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_generator_set_actions_on_compare_event(config.gena,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MCPWM_GEN_COMPARE_EVENT_ACTION(MCPWM_TIMER_DIRECTION_UP, config.cmpa, MCPWM_GEN_ACTION_LOW),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MCPWM_GEN_COMPARE_EVENT_ACTION_END()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 步驟 7: 設置生成器 B 的動作 (互補輸出)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_generator_set_actions_on_timer_event(config.genb,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MCPWM_GEN_TIMER_EVENT_ACTION(MCPWM_TIMER_DIRECTION_UP, MCPWM_TIMER_EVENT_EMPTY, MCPWM_GEN_ACTION_LOW),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MCPWM_GEN_TIMER_EVENT_ACTION_END()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_generator_set_actions_on_compare_event(config.genb,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MCPWM_GEN_COMPARE_EVENT_ACTION(MCPWM_TIMER_DIRECTION_UP, config.cmpa, MCPWM_GEN_ACTION_HIGH),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MCPWM_GEN_COMPARE_EVENT_ACTION_END()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 步驟 8: 設置初始比較值 (決定初始占空比)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint32_t compare_val = (MCPWM_TIMER_RESOLUTION_HZ / MCPWM_FREQ_HZ_INITIAL) * MCPWM_DUTY_CYCLE_INITIAL / 100;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_comparator_set_compare_value(config.cmpa, compare_val));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_comparator_set_compare_value(config.cmpb, compare_val));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 步驟 9: 啟用 MCPWM 定時器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_timer_enable(config.timer));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 步驟 10: 啟動 MCPWM 定時器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_timer_start_stop(config.timer, MCPWM_TIMER_START_NO_STOP));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_LOGI(TAG, &quot;MCPWM 互補輸出已啟動&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_LOGI(TAG, &quot;GPIO%d: %d%% 占空比, GPIO%d: %d%% 占空比&quot;, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             MCPWM_GPIO_A, MCPWM_DUTY_CYCLE_INITIAL, MCPWM_GPIO_B, 100 - MCPWM_DUTY_CYCLE_INITIAL);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_LOGI(TAG, &quot;頻率: %dHz&quot;, MCPWM_FREQ_HZ_INITIAL);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return config;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 設置占空比</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static void set_duty_cycle(pwm_config_t* config, float duty_cycle) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint32_t compare_val = (MCPWM_TIMER_RESOLUTION_HZ / MCPWM_FREQ_HZ_INITIAL) * duty_cycle / 100;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_comparator_set_compare_value(config-&gt;cmpa, compare_val));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_comparator_set_compare_value(config-&gt;cmpb, compare_val));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 設置頻率</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static void set_frequency(pwm_config_t* config, uint32_t freq_hz) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_timer_set_period(config-&gt;timer, MCPWM_TIMER_RESOLUTION_HZ / freq_hz));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void app_main(void)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 初始化 PWM 配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pwm_config_t pwm_config = init_pwm();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 初始占空比和頻率</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float duty_cycle = MCPWM_DUTY_CYCLE_INITIAL;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint32_t freq_hz = MCPWM_FREQ_HZ_INITIAL;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    while (1) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 每 5 秒鐘改變一次占空比 (30% -&gt; 70% -&gt; 30% ...)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        duty_cycle = (duty_cycle == 30) ? 70 : 30;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        set_duty_cycle(&amp;pwm_config, duty_cycle);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ESP_LOGI(TAG, &quot;占空比已設置為 %.0f%%&quot;, duty_cycle);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vTaskDelay(pdMS_TO_TICKS(5000));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 每 10 秒鐘改變一次頻率 (10kHz -&gt; 5kHz -&gt; 10kHz ...)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        freq_hz = (freq_hz == 10000) ? 5000 : 10000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        set_frequency(&amp;pwm_config, freq_hz);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ESP_LOGI(TAG, &quot;頻率已設置為 %&quot;PRIu32&quot; Hz&quot;, freq_hz);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vTaskDelay(pdMS_TO_TICKS(5000));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="程式碼解析">程式碼解析<a class="hash-link" aria-label="Direct link to 程式碼解析" title="Direct link to 程式碼解析" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#程式碼解析">​</a></h3>
<ol>
<li>
<p><strong>初始化 MCPWM</strong>:</p>
<ul>
<li>創建 MCPWM 定時器、運算器、比較器和生成器。</li>
<li>設置 PWM 頻率和分辨率。</li>
<li>配置 GPIO 輸出。</li>
</ul>
</li>
<li>
<p><strong>設置互補輸出</strong>:</p>
<ul>
<li>通過設置不同的動作使兩個輸出互補。</li>
<li>當一個輸出為高時，另一個為低，反之亦然。</li>
</ul>
</li>
<li>
<p><strong>動態調整</strong>:</p>
<ul>
<li><code>set_duty_cycle</code> 函數用於調整占空比。</li>
<li><code>set_frequency</code> 函數用於調整頻率。</li>
</ul>
</li>
<li>
<p><strong>主循環</strong>:</p>
<ul>
<li>每 5 秒改變一次占空比。</li>
<li>每 10 秒改變一次頻率。</li>
</ul>
</li>
</ol>
<p>這個範例展示了 MCPWM 的基本用法，包括初始化、配置和動態調整。它特別適用於需要精確控制的應用，如電機驅動、LED 調光等。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="步進電機控制範例">步進電機控制範例<a class="hash-link" aria-label="Direct link to 步進電機控制範例" title="Direct link to 步進電機控制範例" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#步進電機控制範例">​</a></h2>
<p>接下來，我們將展示如何使用 MCPWM 控制步進電機。步進電機控制需要精確的脈衝序列，MCPWM 模組非常適合這種應用。</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">mcpwm_step_motor_demo.c</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;freertos/FreeRTOS.h&quot;          // FreeRTOS 標頭檔案</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;freertos/task.h&quot;              // FreeRTOS 任務管理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;esp_log.h&quot;                    // ESP32 日誌記錄</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;driver/mcpwm_prelude.h&quot;       // MCPWM 驅動</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;driver/gpio.h&quot;                // GPIO 驅動</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;inttypes.h&gt;                   // 標準整數類型定義</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static const char *TAG = &quot;stepper_example&quot;; // 日誌標籤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define MCPWM_TIMER_RESOLUTION_HZ 1000000  // MCPWM 計時器分辨率，1MHz，即 1 個 tick 為 1 微秒</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define MCPWM_FREQ_HZ             10000    // MCPWM 頻率，10kHz，可以根據需要調整</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define MCPWM_GPIO_STEP           18       // 步進脈衝輸出的 GPIO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define MCPWM_GPIO_DIR            22       // 方向控制的 GPIO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 定義步進電機配置結構體</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">typedef struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mcpwm_timer_handle_t timer;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mcpwm_oper_handle_t oper;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mcpwm_cmpr_handle_t cmpr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mcpwm_gen_handle_t gen;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int target_steps;                // 目標步數</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volatile int current_steps;      // 當前步數</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bool direction;                  // 方向</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} stepper_config_t;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static stepper_config_t stepper_config; // 全局步進電機配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// MCPWM 中斷處理函數</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static bool IRAM_ATTR mcpwm_isr_handler(mcpwm_timer_handle_t timer, const mcpwm_timer_event_data_t *edata, void *user_data)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    stepper_config_t *config = (stepper_config_t *)user_data; // 取得步進電機配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (config-&gt;current_steps &lt; config-&gt;target_steps) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        config-&gt;current_steps++; // 增加當前步數</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return true;  // 繼續產生脈衝</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ESP_ERROR_CHECK(mcpwm_timer_start_stop(config-&gt;timer, MCPWM_TIMER_STOP_FULL)); // 停止計時器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return false;  // 停止計時器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 初始化步進電機的 MCPWM 控制</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static void init_stepper_mcpwm(void) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_LOGI(TAG, &quot;初始化步進電機 MCPWM 控制&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 配置 MCPWM 計時器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mcpwm_timer_config_t timer_config = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .group_id = 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .clk_src = MCPWM_TIMER_CLK_SRC_DEFAULT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .resolution_hz = MCPWM_TIMER_RESOLUTION_HZ,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .period_ticks = MCPWM_TIMER_RESOLUTION_HZ / MCPWM_FREQ_HZ,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .count_mode = MCPWM_TIMER_COUNT_MODE_UP,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_new_timer(&amp;timer_config, &amp;stepper_config.timer));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 配置 MCPWM 操作器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mcpwm_operator_config_t operator_config = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .group_id = 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_new_operator(&amp;operator_config, &amp;stepper_config.oper));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_operator_connect_timer(stepper_config.oper, stepper_config.timer));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 配置 MCPWM 比較器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mcpwm_comparator_config_t comparator_config = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .flags.update_cmp_on_tez = true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_new_comparator(stepper_config.oper, &amp;comparator_config, &amp;stepper_config.cmpr));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 配置 MCPWM 產生器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mcpwm_generator_config_t generator_config = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .gen_gpio_num = MCPWM_GPIO_STEP,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_new_generator(stepper_config.oper, &amp;generator_config, &amp;stepper_config.gen));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 設置 MCPWM 產生器在計時器事件上的動作</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_generator_set_actions_on_timer_event(stepper_config.gen,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MCPWM_GEN_TIMER_EVENT_ACTION(MCPWM_TIMER_DIRECTION_UP, MCPWM_TIMER_EVENT_EMPTY, MCPWM_GEN_ACTION_HIGH),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MCPWM_GEN_TIMER_EVENT_ACTION_END()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_generator_set_actions_on_compare_event(stepper_config.gen,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MCPWM_GEN_COMPARE_EVENT_ACTION(MCPWM_TIMER_DIRECTION_UP, stepper_config.cmpr, MCPWM_GEN_ACTION_LOW),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MCPWM_GEN_COMPARE_EVENT_ACTION_END()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 設置 MCPWM 比較器的比較值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_comparator_set_compare_value(stepper_config.cmpr, MCPWM_TIMER_RESOLUTION_HZ / MCPWM_FREQ_HZ / 2));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 註冊 MCPWM 計時器事件回調</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_timer_register_event_callbacks(stepper_config.timer, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &amp;(mcpwm_timer_event_callbacks_t){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .on_full = mcpwm_isr_handler,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }, &amp;stepper_config));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 啟用 MCPWM 計時器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_timer_enable(stepper_config.timer));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 初始化方向控制 GPIO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gpio_config_t io_conf = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .intr_type = GPIO_INTR_DISABLE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .mode = GPIO_MODE_OUTPUT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .pin_bit_mask = (1ULL &lt;&lt; MCPWM_GPIO_DIR),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .pull_down_en = 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .pull_up_en = 1  // 啟用內部上拉</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gpio_config(&amp;io_conf);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 確保方向引腳初始狀態</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gpio_set_level(MCPWM_GPIO_DIR, 0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_LOGI(TAG, &quot;步進電機 MCPWM 控制初始化完成&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_LOGI(TAG, &quot;MCPWM 步進引腳: %d, 方向引腳: %d&quot;, MCPWM_GPIO_STEP, MCPWM_GPIO_DIR);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 控制步進電機移動</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static void move_stepper(int steps, bool direction) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_LOGI(TAG, &quot;準備移動步進電機：%d 步, 方向：%s&quot;, steps, direction ? &quot;正向&quot; : &quot;反向&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 檢查當前 GPIO 狀態</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int current_dir = gpio_get_level(MCPWM_GPIO_DIR);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_LOGI(TAG, &quot;當前方向引腳狀態: %d&quot;, current_dir);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 確保上一次移動已經完全停止</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    while (stepper_config.current_steps &lt; stepper_config.target_steps) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vTaskDelay(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 停止計時器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_timer_start_stop(stepper_config.timer, MCPWM_TIMER_STOP_FULL));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_LOGI(TAG, &quot;MCPWM 計時器已停止&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 設置新的方向</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gpio_set_level(MCPWM_GPIO_DIR, direction);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_LOGI(TAG, &quot;方向已設置為: %d&quot;, direction);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 添加短暫延遲，確保方向信號穩定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vTaskDelay(pdMS_TO_TICKS(5));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 再次檢查 GPIO 狀態</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    current_dir = gpio_get_level(MCPWM_GPIO_DIR);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_LOGI(TAG, &quot;設置後方向引腳狀態: %d&quot;, current_dir);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 更新步進配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    stepper_config.target_steps = steps;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    stepper_config.current_steps = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    stepper_config.direction = direction;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 啟動計時器，開始步進</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_timer_start_stop(stepper_config.timer, MCPWM_TIMER_START_NO_STOP));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_LOGI(TAG, &quot;MCPWM 計時器已啟動，開始移動&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 主應用程序入口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void app_main(void)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    init_stepper_mcpwm(); // 初始化步進電機 MCPWM 控制</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    while (1) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 正向旋轉 20000 步</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        move_stepper(20000, true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        while (stepper_config.current_steps &lt; stepper_config.target_steps) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            vTaskDelay(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ESP_LOGI(TAG, &quot;完成正向旋轉 20000 步&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vTaskDelay(pdMS_TO_TICKS(2000)); // 延遲 2 秒</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 反向旋轉 20000 步</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        move_stepper(20000, false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        while (stepper_config.current_steps &lt; stepper_config.target_steps) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            vTaskDelay(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ESP_LOGI(TAG, &quot;完成反向旋轉 20000 步&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vTaskDelay(pdMS_TO_TICKS(2000)); // 延遲 2 秒</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="程式碼解析-1">程式碼解析<a class="hash-link" aria-label="Direct link to 程式碼解析" title="Direct link to 程式碼解析" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#程式碼解析-1">​</a></h3>
<ol>
<li>
<p><strong>初始化 MCPWM</strong>:</p>
<ul>
<li>設置 MCPWM 計時器、運算器、比較器和生成器。</li>
<li>配置步進脈衝輸出和方向控制 GPIO。</li>
</ul>
</li>
<li>
<p><strong>中斷處理</strong>:</p>
<ul>
<li>使用 MCPWM 的中斷功能來計數步數。</li>
<li>當達到目標步數時停止計時器。</li>
</ul>
</li>
<li>
<p><strong>步進電機移動控制</strong>:</p>
<ul>
<li><code>move_stepper</code> 函數控制電機的移動方向和步數。</li>
<li>在改變方向時添加短暫延遲，確保信號穩定。</li>
</ul>
</li>
<li>
<p><strong>主循環</strong>:</p>
<ul>
<li>交替進行正向和反向旋轉，每次 20000 步。</li>
<li>每次移動後等待 2 秒。</li>
</ul>
</li>
</ol>
<p>這個範例展示了如何使用 MCPWM 精確控制步進電機。它特別適用於需要精確定位的應用，如 3D 打印機、CNC 機床等。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="步進電機控制的優化建議">步進電機控制的優化建議<a class="hash-link" aria-label="Direct link to 步進電機控制的優化建議" title="Direct link to 步進電機控制的優化建議" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#步進電機控制的優化建議">​</a></h3>
<ol>
<li>
<p><strong>加速和減速</strong>:
為了實現更平滑的運動和減少機械應力，可以實現加速和減速控制。這可以通過動態調整 MCPWM 的頻率來實現。</p>
</li>
<li>
<p><strong>微步控制</strong>:
如果步進電機驅動器支持微步控制，可以通過調整 PWM 占空比來實現更精細的位置控制。</p>
</li>
<li>
<p><strong>位置跟踪</strong>:
可以添加編碼器反饋來實現閉環控制，提高定位精度。</p>
</li>
<li>
<p><strong>多軸協調</strong>:
對於需要多個電機協同工作的應用（如 3D 打印機），可以使用多個 MCPWM 單元並同步它們的操作。</p>
</li>
</ol>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="mcpwm-進階功能">MCPWM 進階功能<a class="hash-link" aria-label="Direct link to MCPWM 進階功能" title="Direct link to MCPWM 進階功能" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#mcpwm-進階功能">​</a></h2>
<p>ESP32 的 MCPWM 模組還提供了一些進階功能，可以用於更複雜的應用場景：</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1-死區控制">1. 死區控制<a class="hash-link" aria-label="Direct link to 1. 死區控制" title="Direct link to 1. 死區控制" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#1-死區控制">​</a></h3>
<p>死區控制在驅動半橋或全橋電路時非常重要，可以防止上下管同時導通造成短路。MCPWM 模組支持硬件級的死區插入，使用方法如下：</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token class-name">mcpwm_dead_time_config_t</span><span class="token plain"> dead_time_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">posedge_delay_ticks </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 上升沿延遲</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">negedge_delay_ticks </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 下降沿延遲</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ESP_ERROR_CHECK</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">mcpwm_generator_set_dead_time</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gen_a</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> gen_b</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">dead_time_config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2-故障處理">2. 故障處理<a class="hash-link" aria-label="Direct link to 2. 故障處理" title="Direct link to 2. 故障處理" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#2-故障處理">​</a></h3>
<p>MCPWM 模組可以配置故障輸入，在檢測到故障信號時自動關閉輸出，提高系統安全性：</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token class-name">mcpwm_fault_config_t</span><span class="token plain"> fault_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fault_gpio_num </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> FAULT_GPIO</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">active_level </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 低電平觸發</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ESP_ERROR_CHECK</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">mcpwm_new_fault</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MCPWM_UNIT_0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">fault_config</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">fault_handle</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3-同步操作">3. 同步操作<a class="hash-link" aria-label="Direct link to 3. 同步操作" title="Direct link to 3. 同步操作" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#3-同步操作">​</a></h3>
<p>對於需要精確同步的多電機控制應用，可以使用 MCPWM 的同步功能：</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token class-name">mcpwm_sync_config_t</span><span class="token plain"> sync_config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sync_gpio_num </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> SYNC_GPIO</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">flags</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">on_rising_edge </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ESP_ERROR_CHECK</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">mcpwm_timer_set_sync_src</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">timer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">sync_config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="結論">結論<a class="hash-link" aria-label="Direct link to 結論" title="Direct link to 結論" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#結論">​</a></h2>
<p>ESP32 的 MCPWM 模組是一個強大而靈活的工具，特別適合各種電機控制應用。</p>
<p>參考資料：</p>
<ol>
<li>ESP32 技術參考手冊</li>
<li>ESP-IDF 編程指南</li>
<li>Espressif Systems 官方文檔</li>
</ol>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="完整代码">完整代码<a class="hash-link" aria-label="Direct link to 完整代码" title="Direct link to 完整代码" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#完整代码">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="互補脈寬調製">互補脈寬調製<a class="hash-link" aria-label="Direct link to 互補脈寬調製" title="Direct link to 互補脈寬調製" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#互補脈寬調製">​</a></h3>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">mcpwm_normal_pwm_demo.c</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;freertos/FreeRTOS.h&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;freertos/task.h&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;esp_log.h&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;driver/mcpwm_prelude.h&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;inttypes.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static const char *TAG = &quot;example&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 定義 MCPWM 參數</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define MCPWM_TIMER_RESOLUTION_HZ 10000000 // 10MHz, 1 tick = 0.1us</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define MCPWM_FREQ_HZ_INITIAL     10000    // 初始頻率為 10KHz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define MCPWM_GPIO_A              18       // PWM 輸出 A 的 GPIO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define MCPWM_GPIO_B              21       // PWM 輸出 B 的 GPIO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define MCPWM_DUTY_CYCLE_INITIAL  30       // 初始占空比為 30%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// PWM 配置結構體</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">typedef struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mcpwm_timer_handle_t timer;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mcpwm_oper_handle_t oper;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mcpwm_cmpr_handle_t cmpa;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mcpwm_cmpr_handle_t cmpb;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mcpwm_gen_handle_t gena;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mcpwm_gen_handle_t genb;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} pwm_config_t;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 初始化 PWM</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static pwm_config_t init_pwm(void) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pwm_config_t config;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_LOGI(TAG, &quot;初始化 MCPWM 模組&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 步驟 1: 創建 MCPWM 定時器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mcpwm_timer_config_t timer_config = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .group_id = 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .clk_src = MCPWM_TIMER_CLK_SRC_DEFAULT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .resolution_hz = MCPWM_TIMER_RESOLUTION_HZ,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .period_ticks = MCPWM_TIMER_RESOLUTION_HZ / MCPWM_FREQ_HZ_INITIAL,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .count_mode = MCPWM_TIMER_COUNT_MODE_UP,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_new_timer(&amp;timer_config, &amp;config.timer));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 步驟 2: 創建 MCPWM 運算器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mcpwm_operator_config_t operator_config = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .group_id = 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_new_operator(&amp;operator_config, &amp;config.oper));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 步驟 3: 將定時器連接到運算器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_operator_connect_timer(config.oper, config.timer));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 步驟 4: 創建比較器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mcpwm_comparator_config_t comparator_config = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .flags.update_cmp_on_tez = true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_new_comparator(config.oper, &amp;comparator_config, &amp;config.cmpa));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_new_comparator(config.oper, &amp;comparator_config, &amp;config.cmpb));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 步驟 5: 創建 PWM 生成器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mcpwm_generator_config_t generator_config = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .gen_gpio_num = MCPWM_GPIO_A,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_new_generator(config.oper, &amp;generator_config, &amp;config.gena));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    generator_config.gen_gpio_num = MCPWM_GPIO_B;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_new_generator(config.oper, &amp;generator_config, &amp;config.genb));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 步驟 6: 設置生成器 A 的動作 (占空比)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_generator_set_actions_on_timer_event(config.gena,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MCPWM_GEN_TIMER_EVENT_ACTION(MCPWM_TIMER_DIRECTION_UP, MCPWM_TIMER_EVENT_EMPTY, MCPWM_GEN_ACTION_HIGH),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MCPWM_GEN_TIMER_EVENT_ACTION_END()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_generator_set_actions_on_compare_event(config.gena,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MCPWM_GEN_COMPARE_EVENT_ACTION(MCPWM_TIMER_DIRECTION_UP, config.cmpa, MCPWM_GEN_ACTION_LOW),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MCPWM_GEN_COMPARE_EVENT_ACTION_END()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 步驟 7: 設置生成器 B 的動作 (互補輸出)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_generator_set_actions_on_timer_event(config.genb,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MCPWM_GEN_TIMER_EVENT_ACTION(MCPWM_TIMER_DIRECTION_UP, MCPWM_TIMER_EVENT_EMPTY, MCPWM_GEN_ACTION_LOW),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MCPWM_GEN_TIMER_EVENT_ACTION_END()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_generator_set_actions_on_compare_event(config.genb,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MCPWM_GEN_COMPARE_EVENT_ACTION(MCPWM_TIMER_DIRECTION_UP, config.cmpa, MCPWM_GEN_ACTION_HIGH),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MCPWM_GEN_COMPARE_EVENT_ACTION_END()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 步驟 8: 設置初始比較值 (決定初始占空比)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint32_t compare_val = (MCPWM_TIMER_RESOLUTION_HZ / MCPWM_FREQ_HZ_INITIAL) * MCPWM_DUTY_CYCLE_INITIAL / 100;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_comparator_set_compare_value(config.cmpa, compare_val));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_comparator_set_compare_value(config.cmpb, compare_val));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //adddd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // mcpwm_dead_time_config_t dead_time_config = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //     .posedge_delay_ticks = 50,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //     .negedge_delay_ticks = 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ESP_ERROR_CHECK(mcpwm_generator_set_dead_time(config.cmpa, config.cmpa, &amp;dead_time_config));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // dead_time_config.posedge_delay_ticks = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // dead_time_config.negedge_delay_ticks = 100;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ESP_ERROR_CHECK(mcpwm_generator_set_dead_time(config.cmpa, config.cmpb, &amp;dead_time_config));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //adddd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 步驟 9: 啟用 MCPWM 定時器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_timer_enable(config.timer));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 步驟 10: 啟動 MCPWM 定時器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_timer_start_stop(config.timer, MCPWM_TIMER_START_NO_STOP));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_LOGI(TAG, &quot;MCPWM 互補輸出已啟動&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_LOGI(TAG, &quot;GPIO%d: %d%% 占空比, GPIO%d: %d%% 占空比&quot;, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             MCPWM_GPIO_A, MCPWM_DUTY_CYCLE_INITIAL, MCPWM_GPIO_B, 100 - MCPWM_DUTY_CYCLE_INITIAL);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_LOGI(TAG, &quot;頻率: %dHz&quot;, MCPWM_FREQ_HZ_INITIAL);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return config;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 設置占空比</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static void set_duty_cycle(pwm_config_t* config, float duty_cycle) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint32_t compare_val = (MCPWM_TIMER_RESOLUTION_HZ / MCPWM_FREQ_HZ_INITIAL) * duty_cycle / 100;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_comparator_set_compare_value(config-&gt;cmpa, compare_val));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_comparator_set_compare_value(config-&gt;cmpb, compare_val));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 設置頻率</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static void set_frequency(pwm_config_t* config, uint32_t freq_hz) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_timer_set_period(config-&gt;timer, MCPWM_TIMER_RESOLUTION_HZ / freq_hz));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void app_main(void)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 初始化 PWM 配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pwm_config_t pwm_config = init_pwm();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 初始占空比和頻率</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float duty_cycle = MCPWM_DUTY_CYCLE_INITIAL;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint32_t freq_hz = MCPWM_FREQ_HZ_INITIAL;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    while (1) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 每 5 秒鐘改變一次占空比 (30% -&gt; 70% -&gt; 30% ...)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        duty_cycle = (duty_cycle == 30) ? 70 : 30;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        set_duty_cycle(&amp;pwm_config, duty_cycle);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ESP_LOGI(TAG, &quot;占空比已設置為 %.0f%%&quot;, duty_cycle);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vTaskDelay(pdMS_TO_TICKS(5000));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 每 10 秒鐘改變一次頻率 (10kHz -&gt; 5kHz -&gt; 10kHz ...)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        freq_hz = (freq_hz == 10000) ? 5000 : 10000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        set_frequency(&amp;pwm_config, freq_hz);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ESP_LOGI(TAG, &quot;頻率已設置為 %&quot;PRIu32&quot; Hz&quot;, freq_hz);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vTaskDelay(pdMS_TO_TICKS(5000));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="步進電機控制">步進電機控制<a class="hash-link" aria-label="Direct link to 步進電機控制" title="Direct link to 步進電機控制" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#步進電機控制">​</a></h3>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">mcpwm_step_motor_demo.c</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;freertos/FreeRTOS.h&quot;          // FreeRTOS 標頭檔案</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;freertos/task.h&quot;              // FreeRTOS 任務管理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;esp_log.h&quot;                    // ESP32 日誌記錄</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;driver/mcpwm_prelude.h&quot;       // MCPWM 驅動</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;driver/gpio.h&quot;                // GPIO 驅動</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;inttypes.h&gt;                   // 標準整數類型定義</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static const char *TAG = &quot;stepper_example&quot;; // 日誌標籤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define MCPWM_TIMER_RESOLUTION_HZ 1000000  // MCPWM 計時器分辨率，1MHz，即 1 個 tick 為 1 微秒</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define MCPWM_FREQ_HZ             10000    // MCPWM 頻率，10kHz，可以根據需要調整</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define MCPWM_GPIO_STEP           18       // 步進脈衝輸出的 GPIO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define MCPWM_GPIO_DIR            22       // 方向控制的 GPIO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 定義步進電機配置結構體</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">typedef struct {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mcpwm_timer_handle_t timer;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mcpwm_oper_handle_t oper;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mcpwm_cmpr_handle_t cmpr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mcpwm_gen_handle_t gen;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int target_steps;                // 目標步數</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volatile int current_steps;      // 當前步數</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bool direction;                  // 方向</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} stepper_config_t;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static stepper_config_t stepper_config; // 全局步進電機配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// MCPWM 中斷處理函數</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static bool IRAM_ATTR mcpwm_isr_handler(mcpwm_timer_handle_t timer, const mcpwm_timer_event_data_t *edata, void *user_data)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    stepper_config_t *config = (stepper_config_t *)user_data; // 取得步進電機配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (config-&gt;current_steps &lt; config-&gt;target_steps) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        config-&gt;current_steps++; // 增加當前步數</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return true;  // 繼續產生脈衝</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ESP_ERROR_CHECK(mcpwm_timer_start_stop(config-&gt;timer, MCPWM_TIMER_STOP_FULL)); // 停止計時器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return false;  // 停止計時器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 初始化步進電機的 MCPWM 控制</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static void init_stepper_mcpwm(void) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_LOGI(TAG, &quot;初始化步進電機 MCPWM 控制&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 配置 MCPWM 計時器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mcpwm_timer_config_t timer_config = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .group_id = 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .clk_src = MCPWM_TIMER_CLK_SRC_DEFAULT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .resolution_hz = MCPWM_TIMER_RESOLUTION_HZ,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .period_ticks = MCPWM_TIMER_RESOLUTION_HZ / MCPWM_FREQ_HZ,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .count_mode = MCPWM_TIMER_COUNT_MODE_UP,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_new_timer(&amp;timer_config, &amp;stepper_config.timer));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 配置 MCPWM 操作器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mcpwm_operator_config_t operator_config = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .group_id = 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_new_operator(&amp;operator_config, &amp;stepper_config.oper));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_operator_connect_timer(stepper_config.oper, stepper_config.timer));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 配置 MCPWM 比較器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mcpwm_comparator_config_t comparator_config = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .flags.update_cmp_on_tez = true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_new_comparator(stepper_config.oper, &amp;comparator_config, &amp;stepper_config.cmpr));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 配置 MCPWM 產生器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mcpwm_generator_config_t generator_config = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .gen_gpio_num = MCPWM_GPIO_STEP,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_new_generator(stepper_config.oper, &amp;generator_config, &amp;stepper_config.gen));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 設置 MCPWM 產生器在計時器事件上的動作</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_generator_set_actions_on_timer_event(stepper_config.gen,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MCPWM_GEN_TIMER_EVENT_ACTION(MCPWM_TIMER_DIRECTION_UP, MCPWM_TIMER_EVENT_EMPTY, MCPWM_GEN_ACTION_HIGH),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MCPWM_GEN_TIMER_EVENT_ACTION_END()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_generator_set_actions_on_compare_event(stepper_config.gen,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MCPWM_GEN_COMPARE_EVENT_ACTION(MCPWM_TIMER_DIRECTION_UP, stepper_config.cmpr, MCPWM_GEN_ACTION_LOW),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MCPWM_GEN_COMPARE_EVENT_ACTION_END()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 設置 MCPWM 比較器的比較值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_comparator_set_compare_value(stepper_config.cmpr, MCPWM_TIMER_RESOLUTION_HZ / MCPWM_FREQ_HZ / 2));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 註冊 MCPWM 計時器事件回調</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_timer_register_event_callbacks(stepper_config.timer, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &amp;(mcpwm_timer_event_callbacks_t){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .on_full = mcpwm_isr_handler,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }, &amp;stepper_config));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 啟用 MCPWM 計時器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_timer_enable(stepper_config.timer));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 初始化方向控制 GPIO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gpio_config_t io_conf = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .intr_type = GPIO_INTR_DISABLE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .mode = GPIO_MODE_OUTPUT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .pin_bit_mask = (1ULL &lt;&lt; MCPWM_GPIO_DIR),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .pull_down_en = 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .pull_up_en = 1  // 啟用內部上拉</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gpio_config(&amp;io_conf);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 確保方向引腳初始狀態</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gpio_set_level(MCPWM_GPIO_DIR, 0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_LOGI(TAG, &quot;步進電機 MCPWM 控制初始化完成&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_LOGI(TAG, &quot;MCPWM 步進引腳: %d, 方向引腳: %d&quot;, MCPWM_GPIO_STEP, MCPWM_GPIO_DIR);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 控制步進電機移動</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static void move_stepper(int steps, bool direction) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_LOGI(TAG, &quot;準備移動步進電機：%d 步, 方向：%s&quot;, steps, direction ? &quot;正向&quot; : &quot;反向&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 檢查當前 GPIO 狀態</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int current_dir = gpio_get_level(MCPWM_GPIO_DIR);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_LOGI(TAG, &quot;當前方向引腳狀態: %d&quot;, current_dir);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 確保上一次移動已經完全停止</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    while (stepper_config.current_steps &lt; stepper_config.target_steps) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vTaskDelay(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 停止計時器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_timer_start_stop(stepper_config.timer, MCPWM_TIMER_STOP_FULL));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_LOGI(TAG, &quot;MCPWM 計時器已停止&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 設置新的方向</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    gpio_set_level(MCPWM_GPIO_DIR, direction);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_LOGI(TAG, &quot;方向已設置為: %d&quot;, direction);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 添加短暫延遲，確保方向信號穩定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vTaskDelay(pdMS_TO_TICKS(5));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 再次檢查 GPIO 狀態</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    current_dir = gpio_get_level(MCPWM_GPIO_DIR);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_LOGI(TAG, &quot;設置後方向引腳狀態: %d&quot;, current_dir);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 更新步進配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    stepper_config.target_steps = steps;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    stepper_config.current_steps = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    stepper_config.direction = direction;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 啟動計時器，開始步進</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_ERROR_CHECK(mcpwm_timer_start_stop(stepper_config.timer, MCPWM_TIMER_START_NO_STOP));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ESP_LOGI(TAG, &quot;MCPWM 計時器已啟動，開始移動&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 主應用程序入口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void app_main(void)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    init_stepper_mcpwm(); // 初始化步進電機 MCPWM 控制</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    while (1) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 正向旋轉 20000 步</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        move_stepper(20000, true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        while (stepper_config.current_steps &lt; stepper_config.target_steps) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            vTaskDelay(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ESP_LOGI(TAG, &quot;完成正向旋轉 20000 步&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vTaskDelay(pdMS_TO_TICKS(2000)); // 延遲 2 秒</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 反向旋轉 20000 步</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        move_stepper(20000, false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        while (stepper_config.current_steps &lt; stepper_config.target_steps) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            vTaskDelay(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ESP_LOGI(TAG, &quot;完成反向旋轉 20000 步&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vTaskDelay(pdMS_TO_TICKS(2000)); // 延遲 2 秒</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-tags-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/en/tags/esp-32">ESP32</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/en/tags/embedded-systems">Embedded Systems</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/en/tags/mcpwm">MCPWM</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/en/tags/stepper-motor-control">Stepper Motor Control</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/en/tags/pwm">PWM</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/en/tags/motor-control">Motor Control</a></li></ul></div></div><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/tianrking/tianrking.github.io/tree/V3.4/docs/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2024-07-16T11:01:38.000Z" itemprop="dateModified">Jul 16, 2024</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/en/micro-controladores/ESP32/esp32-lista-de-ejemplos-de-programacion"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Guía de Ejemplos de Programación para ESP32 | ESP32 编程示例指南</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/en/micro-controladores/ESP32/esp32-rp2040-nrf24l01-wireless-communication"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">ESP32 and RP2040 Wireless Communication with NRF24L01 | ESP32 與 RP2040 使用 NRF24L01 無線通信模組指南</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#引言">引言</a></li><li><a class="table-of-contents__link toc-highlight" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#esp32-引腳功能推薦">ESP32 引腳功能推薦</a><ul><li><a class="table-of-contents__link toc-highlight" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#通用-gpio-輸入輸出">通用 GPIO (輸入/輸出)</a></li><li><a class="table-of-contents__link toc-highlight" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#adc-類比數位轉換">ADC (類比數位轉換)</a></li><li><a class="table-of-contents__link toc-highlight" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#dac-數位類比轉換">DAC (數位類比轉換)</a></li><li><a class="table-of-contents__link toc-highlight" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#pwm-脈衝寬度調變">PWM (脈衝寬 度調變)</a></li><li><a class="table-of-contents__link toc-highlight" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#i2c">I2C</a></li><li><a class="table-of-contents__link toc-highlight" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#spi">SPI</a></li><li><a class="table-of-contents__link toc-highlight" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#uart">UART</a></li><li><a class="table-of-contents__link toc-highlight" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#電容式觸摸傳感器">電容式觸摸傳感器</a></li><li><a class="table-of-contents__link toc-highlight" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#rtc-gpio-深度睡眠模式可用">RTC GPIO (深度睡眠模式可用)</a></li><li><a class="table-of-contents__link toc-highlight" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#模擬霍爾傳感器">模擬霍爾傳感器</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#mcpwm-基礎知識">MCPWM 基礎知識</a></li><li><a class="table-of-contents__link toc-highlight" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#互補脈寬調製範例">互補脈寬調製範例</a><ul><li><a class="table-of-contents__link toc-highlight" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#程式碼解析">程式碼解析</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#步進電機控制範例">步進電機控制範例</a><ul><li><a class="table-of-contents__link toc-highlight" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#程式碼解析-1">程式碼解析</a></li><li><a class="table-of-contents__link toc-highlight" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#步進電機控制的優化建議">步進電機控制的優化建議</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#mcpwm-進階功能">MCPWM 進階功能</a><ul><li><a class="table-of-contents__link toc-highlight" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#1-死區控制">1. 死區控制</a></li><li><a class="table-of-contents__link toc-highlight" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#2-故障處理">2. 故障處理</a></li><li><a class="table-of-contents__link toc-highlight" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#3-同步操作">3. 同步操作</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#結論">結論</a></li><li><a class="table-of-contents__link toc-highlight" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#完整代码">完整代码</a><ul><li><a class="table-of-contents__link toc-highlight" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#互補脈寬調製">互補脈寬調製</a></li><li><a class="table-of-contents__link toc-highlight" href="/en/micro-controladores/ESP32/esp32-mcpwm-usage-and-examples#步進電機控制">步進電機控制</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/en/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/en/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/tianrking/tianrking.github.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 w0x7ce. Thanks @meta</div></div></div></footer></div>
</body>
</html>